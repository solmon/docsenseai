<pngx-page-header
  title="Tenant Management"
  info="Manage tenants for multi-tenant deployment."
>
  <button
    type="button"
    class="btn btn-sm btn-outline-primary"
    (click)="openCreateDialog()"
  >
    <i-bs name="plus-circle"></i-bs>&nbsp;<ng-container i18n>Create Tenant</ng-container>
  </button>
</pngx-page-header>

<div class="row mb-3">
  <div class="col-md mb-2 mb-xl-0">
    <div class="form-inline d-flex align-items-center">
      <label class="text-muted me-2 mb-0" i18n>Filter by:</label>
      <input
        class="form-control form-control-sm flex-fill w-auto me-2"
        type="text"
        [(ngModel)]="searchFilter"
        (ngModelChange)="onSearchChange()"
        placeholder="Name or identifier"
        i18n-placeholder
      />
      <select
        class="form-select form-select-sm w-auto"
        [(ngModel)]="statusFilter"
        (ngModelChange)="onStatusFilterChange()"
      >
        <option [ngValue]="null" i18n>All Status</option>
        <option [ngValue]="true" i18n>Active</option>
        <option [ngValue]="false" i18n>Inactive</option>
      </select>
    </div>
  </div>
  <ngb-pagination
    class="col-auto"
    [pageSize]="pageSize"
    [collectionSize]="collectionSize"
    [(page)]="page"
    [maxSize]="5"
    (pageChange)="reloadData()"
    size="sm"
    aria-label="Pagination"
  ></ngb-pagination>
</div>

<div class="card border table-responsive mb-3">
  <table class="table table-hover mb-0">
    <thead>
      <tr>
        <th scope="col" i18n>Name</th>
        <th scope="col" i18n>Identifier</th>
        <th scope="col" i18n>Status</th>
        <th scope="col" i18n>Created</th>
        <th scope="col" class="text-end" i18n>Actions</th>
      </tr>
    </thead>
    <tbody>
      @if (loading) {
        <tr>
          <td colspan="5" class="text-center">
            <span class="spinner-border spinner-border-sm"></span>
          </td>
        </tr>
      } @else if (tenants.length === 0) {
        <tr>
          <td colspan="5" class="text-center text-muted" i18n>
            No tenants found
          </td>
        </tr>
      } @else {
        @for (tenant of tenants; track tenant.id) {
          <tr class="data-row fade" [class.show]="show">
            <td>{{ tenant.name }}</td>
            <td>
              <code>{{ tenant.identifier }}</code>
            </td>
            <td>
              @if (tenant.is_active) {
                <span class="badge bg-success" i18n>Active</span>
              } @else {
                <span class="badge bg-secondary" i18n>Inactive</span>
              }
            </td>
            <td>
              @if (tenant.created_at) {
                {{ tenant.created_at | date: 'short' }}
              }
            </td>
            <td class="text-end">
              <div class="btn-group btn-group-sm">
                <button
                  class="btn btn-outline-primary"
                  (click)="openEditDialog(tenant)"
                  i18n-title
                  title="Edit"
                >
                  <i-bs name="pencil"></i-bs>
                </button>
                @if (tenant.is_active) {
                  <button
                    class="btn btn-outline-warning"
                    (click)="deactivateTenant(tenant)"
                    i18n-title
                    title="Deactivate"
                  >
                    <i-bs name="pause"></i-bs>
                  </button>
                } @else {
                  <button
                    class="btn btn-outline-success"
                    (click)="activateTenant(tenant)"
                    i18n-title
                    title="Activate"
                  >
                    <i-bs name="play"></i-bs>
                  </button>
                }
                <button
                  class="btn btn-outline-danger"
                  (click)="deleteTenant(tenant)"
                  i18n-title
                  title="Delete"
                >
                  <i-bs name="trash"></i-bs>
                </button>
              </div>
            </td>
          </tr>
        }
      }
    </tbody>
  </table>
</div>

@if (!loading && collectionSize > 0) {
  <div class="d-flex mb-2">
    <div>
      <ng-container i18n
        >{collectionSize, plural, =1 {One tenant} other {{{collectionSize}} total
        tenants}}</ng-container
      >
    </div>
    @if (collectionSize > pageSize) {
      <ngb-pagination
        class="ms-auto"
        [pageSize]="pageSize"
        [collectionSize]="collectionSize"
        [(page)]="page"
        [maxSize]="5"
        (pageChange)="reloadData()"
        size="sm"
        aria-label="Pagination"
      ></ngb-pagination>
    }
  </div>
}

